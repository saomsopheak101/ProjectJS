<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sign up</title>
    <link rel="shortcut icon" type="image/png" href="../images/img-pet/logo/favicon.png">
    <link rel="stylesheet" href="../css/bootstrap.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../icons/fontawesome/css/all.min.css">
   
</head>

<body class="overflow-x-hidden">

    <!--*******************
        Preloader start
    ********************-->
	<div id="preloader">
		<div class="lds-ripple">
			<div></div>
			<div></div>
		</div>
	</div>
	<!--*******************
        Preloader end
    ********************-->

    <header class="bg-black">
        <nav class="navbar navbar-expand-lg py-3 z-3">
            <div class="container">
                <a class="navbar-brand" href="">
                    <img src="../images/img-pet/logo/PetZone (2).png" style="width: 70px;" alt="">
                </a>
                <div class="d-flex align-items-center ">
                    <div class="d-flex align-items-center">
                        <button class=" rounded-2 btn-login-header  color-bg text-white border-0 ms-3 " id="login" type="button"
                            onclick="window.location.href='../pages/login.html';">Login</button>
                        <button class="btn rounded-2 btn-login btn-login-header ms-3 " id="login" type="button"
                            onclick="window.location.href='../pages/signup.html';">Sign up</button>
                        <!-- <button class="py-2 px-4 rounded-2 color-bg text-white border-0 ms-3">Register</button> -->

                        <!-- <button class="py-2 px-4 rounded-2 border-0">Booking</button> -->
                    </div>
                    <!-- User profile -->
                </div>
            </div>
        </nav>
    </header>
    <main class="signUp">
        <section class="form-logAndris position-relative mt-5 pt-4 mb-0">
            <img src="../images/img-pet/icon/bone.png" alt width="50px" class="bone-1 position-absolute">
            <img src="../images/img-pet/icon/bone.png" alt width="50px" class="bone-2 position-absolute">
            <div class="container ">
                <div class="row d-flex">
                    <div class="m-auto col-lg-9 bg-image-login   py-2">
                        <div class="row shadow my-4">
                            <div class="col-7 d-lg-flex   flex-column justify-content-center align-items-center">
                                <div class="bg-glass p-4 w-100">
                                    <div class="d-flex justify-content-center align-items-center mb-3 ">
                                        <img src="../images/img-pet/logo/PetZone (2).png" alt width="150px">
                                    </div>
                                    <form onsubmit="getdata(); return false;" action="" class="needs-validation row g-3 position-relative"
                                        novalidate>
                                        <!-- <div class="img-logoform mx-auto d-flex justify-content-center align-items-center">
                                            <img src="images/login and signup/PetZone.png" alt="Logo">
                                        </div> -->
                                        <div class="row m-0 p-0">
                                            <div class="col-6 ">
                                                <div class="form-group position-relative">
                                                    <input type="text" class="form-control mt-3 input-with-icon"
                                                        id="first_name" name="first_name" required
                                                        placeholder="Fisrtname">
                                                    <i class="fa-solid fa-user icon-positions"></i>
                                                </div>
                                                <div class="invalid-feedback" id="first_name-error"></div>
                                                <div class="valid-feedback text-success" id="first_name-success">First Name looks good!</div>
                                            </div>
                                            <div class="col-6 ">
                                                <div class="form-group mt-0 pt-0 position-relative">
                                                    <input type="text" class="form-control mt-3 input-with-icon"
                                                        id="last_name" name="last_name" required
                                                        placeholder="Lastname">
                                                    <i class="fa-solid fa-user icon-positions"></i>
                                                </div>
                                                <div class="invalid-feedback" id="last_name-error"></div>
                                                    <div class="valid-feedback text-success" id="last_name-success">Last Name looks good!</div>
                                            </div>
                                            <div class="col-12 mt-3">
                                                <div class="form-group position-relative">
                                                    <input type="email" class="form-control input-with-icon" id="email"
                                                        name="email" required placeholder="Email address">
                                                    <i class="fa-solid fa-envelope icon-position"></i>
                                                </div>
                                                <div class="invalid-feedback" id="email-error"></div>
                                                <div class="valid-feedback text-success" id="email-success">Email looks good!</div>
                                            </div>
                                            <div class="col-12 mt-3">
                                                <div class="form-group position-relative">
                                                    <input type="password" class="form-control input-with-icon"
                                                        id="password" name="password" required placeholder="Password">
                                                    <i class="fa-solid fa-lock icon-position"></i>
                                                </div>
                                                <div class="invalid-feedback" id="password-error"></div>
                                                    <div class="valid-feedback text-success" id="password-success">Password looks good!</div>

                                            </div>
                                            <div class="col-12 mt-3">
                                                <div class="form-group position-relative">
                                                    <input type="password" class="form-control  input-with-icon"
                                                        id="password_confirmation" name="password_confirmation" required
                                                        placeholder="Confirm password">
                                                    <i class="fa-solid fa-lock icon-position"></i>
                                                </div>
                                                <div class="invalid-feedback" id="password_confirmation-error"></div>
                                                    <div class="valid-feedback text-success" id="password_confirmation-success">Password looks good!</div>
        
                                            </div>
                                            
                                        </div>
                                        
                                        <div class="form-group ms-2">
                                            <div class="check-box">
                                                <input type="checkbox" class="form-check-input " id="rememberMe" required>
                                                <label class="form-check-label text-black" for="remember">Remember
                                                    me</label>
                                            </div>

                                        </div>
                                        <div class="form-group mt-3 btn-login">
                                            <input type="submit" class="btn btn-warning" value="Signup" id="signupButton">
                                            <button class="btn btn-primary d-none" id="spinner" type="button" disabled>
                                                <span class="spinner-border spinner-border-sm"  aria-hidden="true"></span>
                                                <span role="status">Loading...</span>
                                              </button>
                                        </div>
                                        <div class="separator position-relative my-4">
                                            <!-- <p class="text-black">Or register with</p> -->
                                            <div class="position-absolute bg-white p-2">Or register with</div>
                                        </div>
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="login-with-socail">
                                                    <a href="#" class="socail-btn">
                                                        <img src="../images/login and signup/facebookk.png" alt="Facebook">
                                                        <p class="text-black">Facebook</p>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="login-with-socail">
                                                    <a href="#" class="socail-btn">
                                                        <img src="../images/login and signup/googlee.png" alt="Google">
                                                        <p class="text-black">Google</p>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group mt-3">
                                            <p class="text-center mb-0 text-black">Already have an account? <a
                                                    href="../pages/login.html"
                                                    class="text-decoration-none color-text">Log In</a>
                                            </p>
                                        </div>
                                        <div id="errorMessages" class="text-danger text-center"></div>
                                    </form>

                                </div>
                            </div>
                            <div class="col-5 d-none d-lg-flex m-0 position-relative flex-column justify-content-center align-items-center"
                                style="background-image: url(../images/img-pet/sign-up.png); background-position: center; background-size: cover;">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer class="border-1 ">
        <section class="copyright py-4 border-top">
            <div class="container-fluid px-md-5">
                <div class="d-md-flex text-center text-md-start justify-content-between text-white">
                    <p class="m-0 pt-2 ">Copyright Â© 2024 by <span class="color-text">PetZone</span> <span>. All
                            Rights Reserved.</span></p>
                    <p class="text-wrap mb-0">
                        <a href=""><i class="fa-brands fa-facebook-f "></i></a>
                        <a href=""> <i class="fa-brands fa-instagram ms-2"></i></a>
                        <a href=""><i class="fa-brands fa-tiktok ms-2"></i></a>
                        <a href=""><i class="fa-brands fa-twitter ms-2"></i></a>
                    </p>
                </div>
            </div>
        </section>
    </footer>



    <script src="../js/petzone/signup.js"></script>
    <script>
   
        function getdata() {
            // Clear previous error messages
            document.getElementById('email-error').textContent = '';
            document.getElementById('password-error').textContent = '';

            let email = document.querySelector('#email').value.trim();
            let password = document.querySelector('#password').value.trim();

            let emailIsValid = validateEmail(email);
            let passwordIsValid = validatePassword(password);

            // If either field is invalid, stop form submission
            if (!emailIsValid || !passwordIsValid) {
                return; // Prevent login attempt
            }

            // Show loading spinner and update button text
            let loginButton = document.querySelector('#loginButton');
            let spinner = document.querySelector('#spinner');
            loginButton.classList.add('d-none'); // Hide the Login button
            spinner.classList.remove('d-none'); // Show the spinner button

            let formData = new FormData();
            formData.append('email', email);
            formData.append('password', password);

            fetch('https://mps4.chandalen.dev/api/login', {
                method: 'POST',
                headers: { "Accept": "application/json" },
                body: formData
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(json => {

                    // Reset spinner and show login button
                    spinner.classList.add('d-none');
                    loginButton.classList.remove('d-none');

                    if (json.result === true) {
                        handleLoginSuccess(json);
                    } else {
                        alert("Invalid credentials.");

                    }
                })
                .catch(error => {
                    console.error('There was an error!', error);

                    spinner.classList.add('d-none');
                    loginButton.classList.remove('d-none');

                });
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {

                document.getElementById('email-error').textContent = 'Please enter a valid email.';

                document.querySelector('#email').classList.add('is-invalid');
                document.getElementById('email-success').style.display = 'none';
                return false;
            }
            document.querySelector('#email').classList.remove('is-invalid');
            document.getElementById('email-error').textContent = '';
            document.getElementById('email-success').style.display = 'block';
            return true;
        }

        function validatePassword(password) {
            if (password.length < 4) {
                document.getElementById('password-error').textContent = 'Password must be at least 4 characters long.';
                document.querySelector('#password').classList.add('is-invalid');
                document.getElementById('password-success').style.display = 'none';
                return false;
            }
            document.querySelector('#password').classList.remove('is-invalid');
            document.getElementById('password-error').textContent = '';
            document.getElementById('password-success').style.display = 'block';
            return true;
        }

        function handleLoginSuccess(json) {
            if (json.data.roles && json.data.roles.length > 0) {
                const roleName = json.data.roles[0].name;
                if (roleName === 'Normal User') {
                    sessionStorage.setItem('authToken', json.data.token);
                    alert(json.message + " Token stored.");
                    location.href = '../index.html';
                } else if (roleName === 'System Admin') {
                    sessionStorage.setItem('adminToken', json.data.token);
                    alert(json.message + " Token stored.");
                    location.href = '../pages/employee.html';
                } else {
                    alert("User role not recognized.");
                }
            } else {
                alert("No roles assigned to this user.");
            }
        }

    </script>

    <!-- Preloader -->
    <script src="../vendor/global/global.min.js"></script>
	<script src="../js/custom.js"></script>
	
</body>
</html>

